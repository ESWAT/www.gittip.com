{% from 'templates/auth.html' import auth_button with context %}
{% from 'templates/account-row.html' import account_row with context %}

{% if not user.ANON and user.participant == participant %}
<h2>Add Money Every Week
    {% if user.ADMIN and participant.balanced_customer_href %}
        <a href="https://dashboard.balancedpayments.com/#/{{ participant.balanced_customer_href }}"
           title="Go to Balanced Dashboard"><div class="payments-by"></div></a>
    {% else %}
        <div class="payments-by"></div>
    {% endif %}
</h2>
<table class="accounts">
    <tr>
        <td class="account-type">
            <img src="/assets/card_icon.jpg" />
        </td>
        <td class="account-details">
            <div class="account-type">Credit card</div>
            {% if participant.last_bill_result != "" %}
                <span class="none">None</span>
                <button class="secondary" onclick="window.location='/credit-card.html';">
                    + Add
                </button>
            {% else %}
                {{ card['brand'] }} {{ card['number'][-4:] }}
                    <div id="cc-delete">
                        <form action="credit-card.json" class="special" method="POST">
                            <input type="hidden" name="action" value="delete">
                            <div id="delete-cc" class="close" title="Delete card"></div>
                        </form>
                    </div>

            {% endif %}
        </td>
    </tr>
</table>

<h2>Withdraw Money Every Week
    {% if user.ADMIN and participant.balanced_customer_href %}
        <a href="https://dashboard.balancedpayments.com/#/{{ participant.balanced_customer_href }}"
           title="Go to Balanced Dashboard"><div class="payments-by"></div></a>
    {% else %}
        <div class="payments-by"></div>
    {% endif %}
</h2>
<table class="accounts">
    <tr>
        <td class="account-type">
            <img src="/assets/bank_account_icon.jpg" />
        </td>
        <td class="account-details">
            <div class="account-type">Bank account</div>
            {% if participant.last_ach_result != "" %}
                <span class="none">none</span>
                <a class="btn small" href="/bank-account.html">+ Add</a>
            {% else %}
                {{ bank_account['bank_name'] }}
                <div id="ba-delete">
                    <form action="bank-account.json" class="special" method="POST">
                        <input type="hidden" name="action" value="delete">
                        <div id="delete-ba" class="close" title="Delete card"></div>
                    </form>
                </div>
            {% endif %}
        </td>
    </tr>
</table>
{% endif %}

<h2>One-time {% if user.participant == participant %}Receiving{% else %}Giving{% endif %} Options</h2>
<table class="accounts">
    <tr>
        <td class="account-type">
            <img src="/assets/bitcoin.png" />
        </td>
        <td class="account-details">

            {% if not user.ANON and user.participant == participant %}
                <div class="bitcoin">
            {% else %}
                <div>
            {% endif %}
                {% if participant.bitcoin_address %}
                    <a rel="me" href="http://blockchain.info/address/{{ participant.bitcoin_address }}">
                      {{ participant.bitcoin_address }}
                    </a>
                    {% if not user.ANON and user.participant == participant %}
                    <div class="edit-bitcoin">
                        (<a href="javascript:;" class="toggle-bitcoin">Edit</a>) Bitcoin address
                    </div>
                    {% else %}
                    <div class="account-type">
                        Bitcoin address
                    </div>

                    {% endif %}

                {% else %}
                    {% if not user.ANON and user.participant == participant %}
                        Add a <a href="javascript:;" class="toggle-bitcoin">Bitcoin address</a>.
                    {% else %}
                        No Bitcoin receiving address.
                    {% endif %}
                {% endif %}
            </div>
            <form class="bitcoin-submit">
                <div class="address">
                    <input type="text" class="bitcoin hidden"
                        {% if participant.bitcoin_address %}
                            value="{{ participant.bitcoin_address }}"
                        {% endif %}
                    >
                </div>
                <div class="buttons">
                    <button type="submit" class="small bitcoin hidden">Save</button>
                    <button type="cancel" class="small bitcoin cancel hidden">Cancel</button>
                </div>
            </form>
        </td>
    </tr>
    {{ account_row(website.platforms.venmo, accounts, auth_button) }}
</table>

<h2>Social Profiles</h2>
<table class="accounts">
    {% for platform in website.social_profiles %}
    {{ account_row(platform, accounts, auth_button) }}
    {% endfor %}
</table>
